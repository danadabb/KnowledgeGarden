<h1 id="api-architecture"><a aria-hidden="true" class="anchor-heading" href="#api-architecture"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>API Architecture</h1>
<h3 id="rpc-rest-and-graphql"><a aria-hidden="true" class="anchor-heading" href="#rpc-rest-and-graphql"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>RPC, REST and GRAPHQL</h3>
<h2 id="rpc---remote-procedure-call"><a aria-hidden="true" class="anchor-heading" href="#rpc---remote-procedure-call"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>RPC - Remote Procedure Call</h2>
<p>Earliest API architecture. RPC is to call a remote "procedure" or a function e.g. from a client application to a server with the running API. For example</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token comment">// this procedure is invoked and the response is returned</span>
<span class="token keyword">function</span> <span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Hello, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>How the procedure is invoked on the server depends on the framework and choice of technology adopted. RPC is just a concept, and in a simple scenario, the method could be determined by simply parsing the url coming from the client.</p>
<p>A contrived example:</p>
<pre class="language-javascript"><code class="language-Javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> port <span class="token operator">=</span> <span class="token number">3000</span>

app<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// extract the method being called from the query params</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> method <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token property-access">query</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token property-access">query</span><span class="token punctuation">.</span><span class="token property-access">a</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> b <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token property-access">query</span><span class="token punctuation">.</span><span class="token property-access">b</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">let</span> methodResponse <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>

  <span class="token comment">// call the method requested</span>
  <span class="token keyword control-flow">switch</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token keyword">case</span> <span class="token string">"add"</span><span class="token operator">:</span>
     	methodResponse <span class="token operator">=</span> <span class="token function">add</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword control-flow">break</span><span class="token punctuation">;</span>
     <span class="token keyword">case</span> <span class="token string">"multiply"</span><span class="token operator">:</span>
     	methodResponse <span class="token operator">=</span> <span class="token function">multiply</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword control-flow">break</span><span class="token punctuation">;</span>
     <span class="token keyword">case</span> <span class="token string">"minus"</span><span class="token operator">:</span>
     	methodResponse <span class="token operator">=</span> <span class="token function">minus</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword control-flow">break</span><span class="token punctuation">;</span>
     <span class="token keyword module">default</span><span class="token operator">:</span>
        methodResponse <span class="token operator">=</span> <span class="token string">"method doesn't exist"</span><span class="token punctuation">;</span>

  <span class="token punctuation">}</span>

  res<span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">result</span><span class="token operator">:</span> methodResponse <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">multiply</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> a <span class="token operator">*</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">minus</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> a <span class="token operator">-</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
app<span class="token punctuation">.</span><span class="token method function property-access">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Example app listening on port </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre>
<p>Calls to the above as follows:</p>
<pre class="language-bash"><code class="language-bash">POST http://localhost:3000/?method<span class="token operator">=</span>multiply<span class="token operator">&#x26;</span><span class="token assign-left variable">a</span><span class="token operator">=</span><span class="token number">400</span><span class="token operator">&#x26;</span><span class="token assign-left variable">b</span><span class="token operator">=</span><span class="token number">2</span>
<span class="token punctuation">{</span>output: <span class="token number">8</span><span class="token punctuation">}</span>

</code></pre>
<h3 id="disadvantages"><a aria-hidden="true" class="anchor-heading" href="#disadvantages"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Disadvantages</h3>
<p><strong>Tight coupling</strong> - RPCs client and server are tightly coupled since function calls need to match.</p>
<p><strong>Security issues</strong> - It may be considered a flaw that the inner workings of the API are somewhat revealed to the client as the method name may imply.</p>
<h3 id="advantages"><a aria-hidden="true" class="anchor-heading" href="#advantages"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Advantages</h3>
<p><strong> Lightweight </strong> RPC APIs are expected not to return a lot of meta data and the most popular frameworks such as gRPC are built in such a way that allows them to be more performant than their REST counterpart.</p>
<h3 id="grpc"><a aria-hidden="true" class="anchor-heading" href="#grpc"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>gRPC</h3>
<p>One of the most notable examples of RPC frameworks in modern day is <a href="https://grpc.io/">gRPC</a>. gRPC is an open-source Google framework used for high performance microservice architecture styles. It's supported by multiple languages/frameworks such as Go, Node, Rust Python and more. It's used by many well known tech companies such as Square, Netlfix and <a href="https://blog.cloudflare.com/road-to-grpc/">Cloudflare</a>.</p>
<p>gRPC is considered highly performant due to:</p>
<ul>
<li>Using HTTP/2 for transport</li>
<li>Allowing both clients and servers to stream data as opposed to polling (<em>Note: I believe this is available due to HTTP/2</em>)</li>
<li>Encouraging Protobuf as the messaging format</li>
</ul>
<p>Protobuf (protocol buffers) are a message format that allow for serialization of structured data in a language neutral way. They are an alternative messaging format to others such as JSON or XML and are considered more compact to achieve low latency.</p>
<p>Example of a Protobuf message:</p>
<pre class="language-protobuf"><code class="language-Protobuf"><span class="token comment">// Person.proto</span>
<span class="token keyword">message</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
  <span class="token keyword">required</span> <span class="token builtin">string</span> name <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">required</span> <span class="token builtin">int32</span> age <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token keyword">optional</span> <span class="token builtin">string</span> email <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>gRPC can be implemented using a variety of languages or frameworks, however it seems performance varies - multiple language performance tests are <a href="https://grpc.io/docs/guides/benchmarking/">performed often</a> on the code base. Note that the <a href="https://grafana-dot-grpc-testing.appspot.com/?kiosk=tv">performance dashboard</a> is missing Node however, it has been <a href="https://www.nexthink.com/blog/comparing-grpc-performance/">benchmarked by 3rd parties</a> and <em>appears</em> to be less performant than alternatives such as Go.</p>
<p>gRPC currently cannot natively communicate with the web via HTML/2. Browsers do not support protobuf payloads and hence, grpc-web was introduced in order to act as a proxy to serialize web payload and give developers the ability to use protobufs across the full stack:</p>
<p><img src="/KnowledgeGarden/assets/images/2022-03-03-10-13-17.png" alt="https://grpc.io/blog/state-of-grpc-web/"></p>
Source: https://grpc.io/blog/state-of-grpc-web/
<br>
<br>
Prior to this, developers were forced to use a REST API with HTTP to communicate with the gRPC backend.
<h4 id="references"><a aria-hidden="true" class="anchor-heading" href="#references"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>References</h4>
<ol>
<li><a href="https://blog.jscrambler.com/rpc-style-vs-rest-web-apis">https://blog.jscrambler.com/rpc-style-vs-rest-web-apis</a></li>
<li><a href="https://grpc.io/">https://grpc.io/</a></li>
</ol>