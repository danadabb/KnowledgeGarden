{"pageProps":{"note":{"id":"yskq69lbyw4kpr8y5sdx9lu","title":"API Architecture","desc":"","updated":1646348040958,"created":1646047028554,"custom":{},"fname":"web.backend.api-architecture","type":"note","vault":{"fsPath":"vault"},"contentHash":"ecff5c00834623cf1b42f9542b738730","links":[],"anchors":{"rpc---remote-procedure-call":{"type":"header","text":"RPC - Remote Procedure Call","value":"rpc---remote-procedure-call","line":10,"column":0,"depth":2},"disadvantages":{"type":"header","text":"Disadvantages","value":"disadvantages","line":78,"column":0,"depth":3},"advantages":{"type":"header","text":"Advantages","value":"advantages","line":100,"column":0,"depth":3},"grpc":{"type":"header","text":"gRPC","value":"grpc","line":106,"column":0,"depth":3},"rest":{"type":"header","text":"REST","value":"rest","line":149,"column":0,"depth":2},"references":{"type":"header","text":"References","value":"references","line":172,"column":0,"depth":4}},"children":[],"parent":"1y1y9h9mi8y9k3i44znhfg3","data":{}},"body":"<h1 id=\"api-architecture\">API Architecture<a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#api-architecture\"></a></h1>\n<p>A note describing some of the different API architectures/protocols, namely RPC, REST and GraphQL.</p>\n<h2 id=\"rpc---remote-procedure-call\">RPC - Remote Procedure Call<a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#rpc---remote-procedure-call\"></a></h2>\n<p>Earliest API architecture. Remote Procedure Call (RPC), as the name implies, calls a remote \"<a href=\"/KnowledgeGarden/programming-paradigms#procedural-programming,1:#*\">procedure</a>\" or a function e.g. from a client application to the API on a server.</p>\n<p>How the procedure/function is invoked on the server depends on the framework and choice of technology adopted. RPC is just a concept, and in a simple scenario, the method called could be determined by simply parsing query parameters from the url coming from the client and performing a string comparison, matching the method from the client to the server.</p>\n<p>A contrived example where a client invokes the API to perform mathematical operations on two numbers 'a' and 'b' and return the result:</p>\n<pre class=\"language-javascript\"><code class=\"language-Javascript\"><span class=\"token doc-comment comment\">/** Server API **/</span>\n<span class=\"token keyword\">const</span> express <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'express'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> app <span class=\"token operator\">=</span> <span class=\"token function\">express</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> port <span class=\"token operator\">=</span> <span class=\"token number\">3000</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/'</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// extract the method being called from the query params</span>\n  <span class=\"token comment\">// URL is in the format http(s)://&#x3C;host>/method=&#x3C;methodName>&#x26;b=&#x3C;b>&#x26;c=&#x3C;c></span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> method <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> req<span class=\"token punctuation\">.</span><span class=\"token property-access\">query</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> a <span class=\"token operator\">=</span> <span class=\"token function\">parseInt</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">.</span><span class=\"token property-access\">query</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">a</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> b <span class=\"token operator\">=</span> <span class=\"token function\">parseInt</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">.</span><span class=\"token property-access\">query</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">b</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">let</span> methodResponse <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// call the method requested - here we do a simple string comparison</span>\n  <span class=\"token comment\">// so that it appears the FE and BE \"share\" procedures</span>\n  <span class=\"token keyword control-flow\">switch</span><span class=\"token punctuation\">(</span>method<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n     <span class=\"token keyword\">case</span> <span class=\"token string\">\"add\"</span><span class=\"token operator\">:</span>\n     \tmethodResponse <span class=\"token operator\">=</span> <span class=\"token function\">add</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">,</span>b<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword control-flow\">break</span><span class=\"token punctuation\">;</span>\n     <span class=\"token keyword\">case</span> <span class=\"token string\">\"multiply\"</span><span class=\"token operator\">:</span>\n     \tmethodResponse <span class=\"token operator\">=</span> <span class=\"token function\">multiply</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">,</span>b<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword control-flow\">break</span><span class=\"token punctuation\">;</span>\n     <span class=\"token keyword\">case</span> <span class=\"token string\">\"minus\"</span><span class=\"token operator\">:</span>\n     \tmethodResponse <span class=\"token operator\">=</span> <span class=\"token function\">minus</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">,</span>b<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword control-flow\">break</span><span class=\"token punctuation\">;</span>\n     <span class=\"token keyword module\">default</span><span class=\"token operator\">:</span>\n        methodResponse <span class=\"token operator\">=</span> <span class=\"token string\">\"method doesn't exist\"</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token punctuation\">}</span>\n\n  res<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">send</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">result</span><span class=\"token operator\">:</span> methodResponse <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">a<span class=\"token punctuation\">,</span> b</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword control-flow\">return</span> a <span class=\"token operator\">+</span> b<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">multiply</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">a<span class=\"token punctuation\">,</span> b</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword control-flow\">return</span> a <span class=\"token operator\">*</span> b<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">minus</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">a<span class=\"token punctuation\">,</span> b</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword control-flow\">return</span> a <span class=\"token operator\">-</span> b<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\napp<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">listen</span><span class=\"token punctuation\">(</span>port<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Example app listening on port </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>port<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n</code></pre>\n<p>A client can communicate to the above API application as follows:</p>\n<pre class=\"language-bash\"><code class=\"language-bash\">GET http://localhost:3000/?method<span class=\"token operator\">=</span>multiply<span class=\"token operator\">&#x26;</span><span class=\"token assign-left variable\">a</span><span class=\"token operator\">=</span><span class=\"token number\">4</span><span class=\"token operator\">&#x26;</span><span class=\"token assign-left variable\">b</span><span class=\"token operator\">=</span><span class=\"token number\">2</span>\n<span class=\"token punctuation\">{</span>output: <span class=\"token number\">8</span><span class=\"token punctuation\">}</span> <span class=\"token comment\">#response recieved</span>\n\n</code></pre>\n<h3 id=\"disadvantages\">Disadvantages<a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#disadvantages\"></a></h3>\n<p><strong>Tight coupling</strong> - RPCs client and server are tightly coupled since function calls need to match.</p>\n<p><strong>Leaking internal implementation</strong> - It may be considered a flaw that the inner workings of the API are somewhat revealed to the client as the backend method names may be \"telling\".</p>\n<p><strong>Extensibility of methods is difficult</strong> - it's often the case that in RPC API's, a procedure may not perform the exact functionality and hence another method that does something slightly different is added. In this case, there is an overload of similar functions which can be messy:</p>\n<pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">multiply</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// does something</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">multiplyV2</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// does something similar to multiply() but different</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">multiplyV3</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// etc</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<h3 id=\"advantages\">Advantages<a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#advantages\"></a></h3>\n<p><strong>Lightweight</strong> - RPC APIs are expected not to return a lot of meta data and the most popular frameworks such as gRPC are built in such a way that allows them to be more performant than their REST counterpart.</p>\n<p><strong>Action-oriented</strong> - RPCs are good for action oriented applications where we are calling 'commands' rather than focusing on resources.</p>\n<h3 id=\"grpc\">gRPC<a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#grpc\"></a></h3>\n<p>One of the most notable examples of RPC frameworks in modern day is <a href=\"https://grpc.io/\">gRPC</a>. gRPC is an open-source Google framework used for high performance microservice architecture styles. It's supported by multiple languages/frameworks such as Go, Node, Rust Python and more. It's used by many well known tech companies such as Square, Netlfix and <a href=\"https://blog.cloudflare.com/road-to-grpc/\">Cloudflare</a>.</p>\n<p>gRPC is considered highly performant due to:</p>\n<ul>\n<li>Using HTTP/2 for transport</li>\n<li>Allowing both clients and servers to stream data as opposed to polling (<em>Note: I believe this is available due to HTTP/2</em>)</li>\n<li>Encouraging <strong>Protobuf</strong> as the messaging format</li>\n</ul>\n<p>Protobuf (protocol buffers) are a message format that allow for serialization of structured data in a language neutral way. They are an alternative messaging format to others such as JSON or XML and are considered more compact to achieve low latency.</p>\n<p>Example of a Protobuf message:</p>\n<pre class=\"language-protobuf\"><code class=\"language-Protobuf\"><span class=\"token comment\">// Person.proto</span>\n<span class=\"token keyword\">message</span> <span class=\"token class-name\">Person</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">required</span> <span class=\"token builtin\">string</span> name <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">required</span> <span class=\"token builtin\">int32</span> age <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">optional</span> <span class=\"token builtin\">string</span> email <span class=\"token operator\">=</span> <span class=\"token number\">3</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<p>Protobufs are encoded in such a way that makes them lightweight and performant.</p>\n<p><img src=\"/KnowledgeGarden/assets/images/2022-03-03-10-51-00.png\"></p>\nSource: https://developers.google.com/protocol-buffers/docs/overview#work\n<br>\n<br>\n<p>gRPC can be implemented using a variety of languages or frameworks, however it seems performance varies - multiple language performance tests are <a href=\"https://grpc.io/docs/guides/benchmarking/\">performed often</a> on the code base. Note that the <a href=\"https://grafana-dot-grpc-testing.appspot.com/?kiosk=tv\">performance dashboard</a> is missing Node however, it has been <a href=\"https://www.nexthink.com/blog/comparing-grpc-performance/\">benchmarked by 3rd parties</a> and <em>appears</em> to be less performant than alternatives such as Go.</p>\n<p>gRPC currently cannot natively communicate with the web via HTML/2. Browsers do not support protobuf payloads and hence, grpc-web was introduced in order to act as a proxy to serialize web payload and give developers the ability to use protobufs across the full stack:</p>\n<p><img src=\"/KnowledgeGarden/assets/images/2022-03-03-10-13-17.png\" alt=\"https://grpc.io/blog/state-of-grpc-web/\"></p>\nSource: https://grpc.io/blog/state-of-grpc-web/\n<br>\n<br>\nPrior to this, developers would likely use REST APIs with HTTP to communicate with the gRPC backend.\n<h2 id=\"rest\">REST<a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#rest\"></a></h2>\n<p><strong>Re</strong>presentational <strong>s</strong>tate <strong>t</strong>ransfer (REST) API is an architectural style created by Roy Fielding, described famously in his <a href=\"https://www.ics.uci.edu/~fielding/pubs/dissertation/rest_arch_style.htm\">dissertation</a>.</p>\n<p>REST is commonly not adhered to when implemented as many APIs do not tick the architectural constraints that make an API \"RESTful\". There are <strong>6 constraints</strong> which make a web service truly RESTful:</p>\n<ol>\n<li><strong>Uniform Interface</strong></li>\n</ol>\n<p>What distinguishes REST is uniform interface whereby the client and server are decoupled in such a way that allows them tfcv o evolve independently. Having this interface provides the client with enough information to retrieve the relevant data without having to understand the underlying implementation. This concept is achieved through these four principles:</p>\n<ul>\n<li>\n<p><strong>Identification of resources</strong> - where RPCs are command or action oriented, REST APIs are modeled around resources. For example, users in a rest API are handled via the URI <code>/user</code></p>\n</li>\n<li>\n<p><strong>Manipulation of resources through representations</strong> - When a client holds a representation of a resource, including any metadata attached, it has enough information to modify or delete the resource on the server. This makes REST APIs <strong>discoverable</strong> in that from the root of the API, the client has enough information to perform any available action on the available resources.</p>\n</li>\n<li>\n<p><strong>self-descriptive messages</strong> - Each message includes enough information to describe how to process the message. For example, by using standard <a href=\"https://en.wikipedia.org/wiki/Media_type#cite_note-10\">MIME Types</a> e.g. <code>application/json</code>, . Responses also explicitly indicate their cache-ability. e.g. <code>Cache-Control: max-age=31536000</code></p>\n</li>\n<li>\n<p><strong>hypermedia as the engine of application state (HATEOAS)</strong> - allows the client to dynamically navigate to the appropriate resources by traversing the hypermedia links. For example, a call to <code>GET http://localhost:8080/users</code> could return:</p>\n</li>\n</ul>\n<pre class=\"language-json\"><code class=\"language-JSON\">\n\n</code></pre>\n<h4 id=\"references\">References<a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#references\"></a></h4>\n<ol>\n<li><a href=\"https://blog.jscrambler.com/rpc-style-vs-rest-web-apis\">https://blog.jscrambler.com/rpc-style-vs-rest-web-apis</a></li>\n<li><a href=\"https://grpc.io/\">https://grpc.io/</a></li>\n<li><a href=\"https://www.restapitutorial.com/lessons/whatisrest.html#\">https://www.restapitutorial.com/lessons/whatisrest.html#</a></li>\n</ol>","noteIndex":{"id":"wn8PE1RhG0znK1alrGFYv","title":"Knowledge Garden","desc":"","updated":1725627729985,"created":1631901573363,"custom":{"nav_order":0,"permalink":"/"},"fname":"root","type":"note","vault":{"fsPath":"vault"},"contentHash":"8d5496c75d3dbc62da1263726aa08b42","links":[],"anchors":{"my-second-brain":{"type":"header","text":"My Second Brain","value":"my-second-brain","line":8,"column":0,"depth":4}},"children":["bwlvrHRccHBUBhHu7Mh1G","7w0mtdy9yip2z8dm44sazxg","8h567033xcainsquqy92vos","514eyidh124uj7yywy9os9z","zbqz5oql3yy88t9yf8q9mtz","XZTCg1c8mZeR9jEyM2HOy","6FtP5bCaxDDd47jEuSH5y","5c0e9ifp2lh9imgp1zahq33","aig5i0xuh2jq0ibzfq8sz22","8HZ1TTh4HUtNFePL29cg7"],"parent":null,"data":{},"body":"\n#### My Second Brain\n\n---\n\nA collection of my notes around all things software development.\n\n> This website is generated by a Dendron template. For more information, see the [template README file](https://github.com/dendronhq/template.publish.github/).\n"},"collectionChildren":null,"customHeadContent":null,"config":{"version":5,"dev":{"enablePreviewV2":true},"commands":{"lookup":{"note":{"selectionMode":"extract","confirmVaultOnCreate":false,"leaveTrace":false,"bubbleUpCreateNew":true,"fuzzThreshold":0.2,"vaultSelectionModeOnCreate":"smart"}},"insertNote":{"initialValue":"templates"},"insertNoteLink":{"aliasMode":"none","enableMultiSelect":false},"insertNoteIndex":{"enableMarker":false},"randomNote":{},"copyNoteLink":{"aliasMode":"title"},"templateHierarchy":"template"},"workspace":{"vaults":[{"fsPath":"vault"}],"journal":{"dailyDomain":"daily","name":"journal","dateFormat":"y.MM.dd","addBehavior":"childOfDomain"},"scratch":{"name":"scratch","dateFormat":"y.MM.dd.HHmmss","addBehavior":"asOwnDomain"},"graph":{"zoomSpeed":1,"createStub":false},"enableAutoCreateOnDefinition":false,"enableXVaultWikiLink":false,"enableRemoteVaultInit":true,"workspaceVaultSyncMode":"noCommit","enableAutoFoldFrontmatter":true,"maxPreviewsCached":10,"maxNoteLength":204800,"task":{"name":"","dateFormat":"","addBehavior":"childOfCurrent","statusSymbols":{"":" ","wip":"w","done":"x","assigned":"a","moved":"m","blocked":"b","delegated":"l","dropped":"d","pending":"y"},"prioritySymbols":{"H":"high","M":"medium","L":"low"},"todoIntegration":false,"createTaskSelectionType":"selection2link","taskCompleteStatus":["done","x"]},"enableUserTags":true,"enableHashTags":true,"dendronVersion":"0.83.0","enableEditorDecorations":true,"enableFullHierarchyNoteTitle":false},"preview":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enablePrettyRefs":true,"enableKatex":true,"automaticallyShowPreview":false,"enableFrontmatterTags":true,"enableHashesForFMTags":false},"publishing":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enablePrettyRefs":true,"enableKatex":true,"copyAssets":true,"siteHierarchies":["root"],"writeStubs":false,"siteRootDir":"docs","seo":{"title":"Dendron","description":"Personal knowledge space"},"github":{"enableEditLink":true,"editLinkText":"Edit this page on GitHub","editBranch":"main","editViewMode":"tree"},"enableSiteLastModified":true,"enableFrontmatterTags":true,"enableHashesForFMTags":false,"enableRandomlyColoredTags":true,"enableTaskNotes":true,"enablePrettyLinks":true,"searchMode":"lookup","assetsPrefix":"/KnowledgeGarden","siteUrl":"https://danadabb.github.io/","duplicateNoteBehavior":{"action":"useVault","payload":["vault"]},"siteFaviconPath":"favicon.ico","siteIndex":"root"}}},"__N_SSG":true}